#ex1-hello-jpa
영속성 컨텍스트
 · 엔티티를 영구 저장하는 환경
 · EntityManager.persist(entity);
 · 영속성 컨텍스트는 논리적인 개념
 · 엔티티 매니저를 통해 영속성 컨텍스트에 접근 
 
엔티티의 생명주기
 · 비영속(new/transient) : 새로운 상태
 · 영속(managed) : 관리되는 상태
 · 준영속(detached) : 분리된 상태
 · 삭제(removed) : 삭제된 상태
 
영속성 컨텍스트의 이점
 · 1차 캐시 → 1차로 DB에서 조회하는 것이 아니라, 1차에서 캐시값 조회
 · 동일성 보장 → 같은 트랜잭션 내에서 가져옴
 · 트랜잭션을 지원하는 쓰기 지연
 · 변경 감지
 · 지연 로딩
 
flush : 영속성 컨텍스트의 변경내용을 데이터베이스에 반영
플러시 발생
 · 변경 감지
 · 수정된 엔티티 쓰기 지연 SQL 저장소에 등록
 · 쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송 (등록, 수정, 삭제 쿼리)
 
영속성 컨텍스트를 플러시하는 방법
 · em.flush() - 직접 호출
 · 트랜잭션 커밋 - 플러시 자동 호출
 · JPQL 쿼리 실행 - 플러시 자동 호출

플러시는 영속성 컨텍스트를 비우지 않음, 변경내용을 데이터베이스에 동기화
트랜잭션이라는 작업 단위가 중요 -> 커밋 직전에만 동기화 하면 됨

준영속 상태
 · 영속 -> 준영속
 · 영속 상태의 엔티티가 영속성 컨텍스트에서 분리
 · 영속성 컨텍스트가 제공하는 기능을 사용 못함
 
준영속 상태로 만드는 방법
 · em.detach(entity) - 특정 엔티티만 준영속 상태로 전환
 · em.clear() - 영속성 컨텍스트를 완전히 초기화
 · em.close() - 영속성 컨텍스트 종료